{"version":3,"sources":["databaseManager.js"],"names":[],"mappings":"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","file":"databaseManager-compiled.js","sourcesContent":["var mysql = require('mysql');\r\nvar HttpResult = require('./HttpResult');\r\n\r\nvar pool = mysql.createPool({  //连接池\r\n\thost:'localhost',\r\n\tuser:'root',\r\n\tpassword:'123456',\r\n\tport:'3306',\r\n\tdatabase:'mystudy'\r\n})\r\n\r\nexports.getItemList = function(req,res){\r\n\tvar httpResult=new HttpResult();\r\n\tpool.getConnection(function(err,conn){\r\n\t\tif(err){\r\n            console.log('与mysql数据库建立连接失败');\r\n\r\n            httpResult.code = -1;\r\n\t\t\thttpResult.description = '数据库操作失败！'\r\n\t\t\tres.send(httpResult);\r\n\t\t}else{\r\n            console.log('与mysql数据库建立连接成功');\r\n            try{\r\n\t\t\t\tvar selectSQL= \"select * from usersinfo\";\r\n\t\t\t\tconn.query(selectSQL,function(err,results){\t\t\r\n\t\t\t\t\tif(err){\t\t\t\r\n\t\t\t\t\t\thttpResult.code=-1;\r\n\t\t\t\t\t\thttpResult.description=\"数据库操作失败！\"\t\t\t\r\n\t\t\t\t\t}else{\t\t\r\n\t\t\t\t\t\thttpResult.code=1;\r\n\t\t\t\t\t\thttpResult.data=results\r\n\t\t\t\t\t}\r\n                    console.log('selectSQL: '+ httpResult.code);\r\n                    res.send(httpResult);\r\n\t\t\t\t\tconn.release();\t\t\t\t\t\t\t\t\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\tcatch(e){\t\t\t\t\r\n\t\t\t\thttpResult.code=-2;\r\n\t\t\t\thttpResult.data=e;\r\n\t\t\t\tres.send(httpResult);\r\n\t\t\t}\t\t\t\r\n\t\t}\r\n\t});\t\r\n}\r\n\r\nexports.addItem = function(req,res){\r\n\tvar httpResult=new HttpResult();\r\n\tpool.getConnection(function(err,conn){\r\n\t\tif(err){\r\n\t\t\thttpResult.code = -1;\r\n\t\t\thttpResult.description = '数据库操作失败！'\r\n\t\t\tres.send(httpResult);\r\n\t\t}else{\t\t\t\r\n\t\t\ttry{\r\n\t\t\t\tvar insertSQL = \"insert usersinfo (name,phone,sex,address,message) values ('\"+req.body.params.name+\"','\"+req.body.params.phone+\"','\"+req.body.params.sex+\"','\"+req.body.params.address+\"','\"+req.body.params.message+\"')\" ;\r\n                conn.query(insertSQL,function(err,results){\r\n\t\t\t\t\tif(err){\r\n\t\t\t\t\t\thttpResult.code = -1;\r\n\t\t\t\t\t\thttpResult.description = '数据库操作失败！'\r\n\t\t\t\t\t}else{\t\t\t\r\n\t\t\t\t\t\thttpResult.code = 1;\r\n\t\t\t\t\t\thttpResult.data = true;\r\n\t\t\t\t\t}\r\n                    res.send(httpResult);\r\n\t\t\t\t\tconn.release();\r\n\t\t\t\t})\t\r\n\t\t\t}\r\n\t\t\tcatch(e){\r\n\t\t\t\thttpResult.code=-2;\r\n\t\t\t\thttpResult.data=e;\r\n\t\t\t\tres.send(httpResult);\r\n\t\t\t}\r\n\t\t}\r\n\t})\t\r\n}\r\n\r\nexports.setPagination = function(req,res){\r\n\tvar httpResult=new HttpResult();\r\n\tpool.getConnection(function(err,conn){\r\n\t\tif(err){\r\n\t\t\thttpResult.code = -1;\r\n\t\t\thttpResult.description = '数据库操作失败！'\r\n\t\t\tres.send(httpResult);\r\n\t\t}else{\r\n\t\t\ttry{\r\n\t\t\t\tvar selectSQL= \"select * from usersinfo\";\r\n\t\t\t\tconn.query(selectSQL,function(err,results){\r\n\t\t\t        if(err){            \r\n\t\t\t            httpResult.code = -1;\r\n\t\t\t            httpResult.description = '数据库操作失败！';                 \r\n\t\t\t        }else{   \r\n\t\t\t            var pageindex = req.params.pageindex;\r\n\t\t\t            var pagesize = req.params.pagesize;\r\n\t\t\t            var startIndex = (pageindex-1)*pagesize;\r\n\t\t\t            var endIndex = pageindex*pagesize;\r\n\t\t\t            if(endIndex>results.length){\r\n\t\t\t                endIndex = results.length;\r\n\t\t\t            }\r\n\t\t\t            var curResult = results.slice(startIndex,endIndex)\r\n\t\t\t            httpResult.code = 1;\r\n\t\t\t            httpResult.data = {itemList:curResult,allCount:results.length};       \r\n\t\t\t        }\r\n\t\t\t        res.send(httpResult);\r\n\t\t\t        conn.release();\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\tcatch(e){\r\n\t\t\t\thttpResult.code=-2;\r\n\t\t\t\thttpResult.data=e;\r\n\t\t\t\tres.send(httpResult);\r\n\t\t\t}\r\n\t\t}\r\n\t})\t\r\n}"]}